# Система "умный дом"
Проект на стадии разработки. В настоящее время возможны значительные изменения в структуре базы данных, которые необходимо выполнять вручную, либо пересоздавать базу данных. Подробности изменений смотрите [в истории версий](HISTORY.md).

[Документация](docs/index.md)

## Цели проекта
Разработка простого сервера умного дома на языке PHP:
- поддержка оборудования, которое имеется у автора проекта;
- максимально простой и понятный код на PHP;
- низкие требования к аппаратному обеспечению с возможностью запуска сервера на одноплатных ПК.

Идея создания данного проекта родилась после использования проекта [Majordomo](https://github.com/sergejey/majordomo), внутри которого очень много устаревшего и потенциально опасного кода (например, не используются подготовленные выражения при работе с БД). Однако, если вы не готовы разбираться в исходном коде моего проекта и писать код самостоятельно, то рекомендую использовать именно [Majordomo](https://github.com/sergejey/majordomo), т.к. он имеет широкий спектр поддерживаемого оборудования и техническую поддержку, в том числе платную. Кроме этого, отлично работает в условиях домашней локальной сети!

На данный момент проект не ставит своими целями:
- создание клона [Majordomo](https://github.com/sergejey/majordomo);
- создание продукта для пользователей, которые не владеют языком программирования PHP;
- поддержку всех имеющихся версий PHP;
- поддержку конфигураций PHP, которые не имеют в своём составе необходимых для работы модулей;
- поддержку работы сервера на семействе ОС Windows;
- поддержку иных языков, кроме русского.

Цели могут быть пересмотрены, если проект окажется востребованным.

## Системные требования
- операционная система семейства Linux или иная с поддержкой разделяемой памяти;
- systemd (рекомендуется);
- PHP 7.2 или выше;
- веб-сервер (рекомендуется nginx с PHP режиме fpm);
- сервер баз данных PostgreSQL-10 и выше.

## Уже реализовано
В текущем состоянии проект имеет следующий функционал:
- Получение данных и управление оборудованием Xiaomi и Yeelight.
- Сбор данных с датчиков температуры, влажности, давления и других аналоговых данных в числовом виде с ведением журнала.
- Сбор данных с цифровых датчиков с ведением журнала.
- Интерфейс для отображения состояния и настройки системы.
- Интерфейс для управления лампами и светильниками.
- Голосовые уведомления с использованием Яндекс SpeechKit.
- Получение информации о погоде с сервера [OpenWeather](https://openweathermap.org).
- Частично реализована работа с навыком умного дома от Яндекс (управление устройствами через голосового ассистента Алиса).

Присутствует система пользовательских скриптов на языке PHP:
- Настройка действий, которые выполняются регулярно (ежеминутно запускается пользовательский скрипт).
- Скрипты, которые выполняются при поступлении новых данных с устройств.
- Скрипты, которые выполняются при подаче команд управления через веб-интерфейс.
- Скрипты, которые формируют страницы панели управления.

### Поддержка умного дома Xiaomi
Поддерживается следующее оборудование:
- Xiaomi Gateway - шлюз Xiaomi;
- Xiaomi Temperature And Humidity Sensor - датчик температуры и влажности;
- Aqara Temperature, Humidity And Pressure Sensor датчик температуры, влажности и атмосферного давления;
- Xiaomi Motion Sensor - датчик движения;
- Xiaomi Magnet Sensor - датчик открытия двери/окна.

Для подключения устройств необходимо включить в настройках "Протокол связи по локальной сети" на шлюзе умного дома Xiaomi.

### Поддержка светильников Yeelight
Используется режим "Управление по LAN" (включается в настройках в мобильном приложении Yeelight). Работает обнаружение светильников, передача команд и опрос текущего состояния.

## Контакты
Обсудить проект можно [в Телеграм группе](https://t.me/phpmd).

Связаться с автором проекта можно по [E-mail: support@tavda.net](mailto:support@tavda.net).