# Файл конфигурации settings.json

Файл конфигурации settings.json является хранилищем основных настроект системы. Пример файла конфигурации приведён в файле settings.sample.json. При установке системы необходимо скопировать этот файл в settings.json и произвести необходимые изменения.
Файл представляет из себя документ типа json.

## Раздел site

Раздел состоит из одного параметра

### Параметр title

Наименование сайта

## Параметр url
```json
"url": "http://127.0.0.1"
```
Указывает URL текущего сервера по которому можно получить доступ к сайту умного дома. URL используется при работе демонов для выполнения запросов на передачу данных от устройств. Параметр необходимо изменять в том случае, если ваш веб-сервер кроме сайта Умного дома обрабатывает запросы других сайтов.

Завершающий слеш не нужен.

## Параметр daemon-ip
```json
"daemon-ip": "127.0.0.1"
```
Адрес устройства, на котором работают демоны. Если демоны работают на этом же устройстве значение параметра менять не нужно. Параметр запрещает передавать данные от устройств по протоколу http любым адресам, которые не соответствуют установленному адресу.

## Раздел fail2ban

Наличие раздела, даже пустого, включает механизм защиты от подбора пароля, который основывается на блокировке пользователя по логину или IP, если им было выполнено большое количество неудачных попыток входа в систему.
```json
"fail2ban": {
    "trusted_proxy_x_real_ip": ["192.168.1.10"]        
}
```
### Параметр trusted_proxy_x_real_ip

Указывает массив IP адрес прокси серверов, которые используются для доступа к серверу умного дома и который передаёт в запросе заголовок X_REAL_IP. Такое возможно, если вы используете отдельный веб-сервер, например nginx, который получая запрос перенаправляет его на веб-сервер умного дома. В таком случае, в качестве адреса источника будет выставлен IP адрес прокси сервера. В случае срабатывания блокировки по IP адресу будут заблокированы все пользователи, которые пытаются войти через прокси сервер.

При получении запроса с IP адреса, который указан в этом списке, для механизма блокировки будет использован IP адрес, который содержится в заголовке X_REAL_IP. Прокси сервер ДОЛЖЕН содержать в настройках установку заголовка X_REAL_IP при пробросе соединения на сервер умного дома!

## Раздел pdo

Параметры подключения к базе данных.
```json
"pdo": {
    "dsn": "pgsql:host=localhost;dbname=phpmd",
    "username": "phpmd",
    "password": "phpmd",
    "init": [
        "SET TIMEZONE=\"Asia/Yekaterinburg\""
    ]
}
```

### Параметр dsn
Должен содержать тип базы данных pgsql (другие БД не поддерживаются), адрес хоста и имя базы данных (phpmd).

### Поля username и password
Задают реквизиты пользователя для подключения к базе данных.

### Поле init
Представляет собой массив команд SQL, которые необходимо выполнить после подключения к базе данных для корректной работы. Для примера устанавливается часовой пояс, который необходим для правильной работы с датами. 

## Раздел session

Задаёт параметры для работы с веб-сессиями.
```json
"session": {
    "name": "phpmd-session",
    "uid": "phpmd-uid",
    "token": "phpmd-token",
    "time": 2592000,
    "path": "/"
}
```

### Параметр name

Имя сессионной cookie. Сайт использует механизм сессий который предоставляет язык PHP.

### Параметр uid

Имя cookie хранящей уникальный идентификатор пользовательской сессии.

### Параметр token

Имя cookie хранящей токен пользовательской сессии. Используется совместно с uid для восстановления сессии PHP без необходимости ввода логина и пароля.

### Параметр time

Время жизни сессии пользователя в секундах. В качестве примера в файле settings.sample.json указано число 2592000, что составляет 30 дней.

### Параметр path

Путь, ко которому будут расположены и доступны cookie. Должен быть всегда "/".

## Раздел yandex

Хранилище параметров модуля yandex.
```json
"yandex": {
    "tts_api_key": "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
}
```

### Параметр tts_api_key

Ключ доступа к синтезу голоса платформы Яндекс. Подробности будут доступы в соответствующем разделе.

## Раздел tts

Настройки касающиеся модуля синтеза речи tts.
```json
"tts": {
    "pre_sound": "dingdong.mp3",
    "play_sound_cmd": "mpg123 -q %s"
}
```

### Параметр pre_sound

Указывает имя файла для воспроизведения перед голосовым сообщением. Параметр может отсутствовать, тогда будет воспроизведена мелодия по умолчанию.

### Параметр play_sound_cmd

Команда для воспроизведения звука. Должна содержать одно включение %s, которое будет заменено на путь к воспроизводимому файлу. Может отсутствовать. По умолчанию значение "mpg123 -q %s". 

## Раздел openweathermap

Параметры модуля получения погоды с сайта openweathermap.org.
```json
"openweathermap": {
    "api_key": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
    "city_id": "1486209"
}
```

### Параметр api_key

Ключ доступа к данных, который должен быть получен через личный кабинет сайта openweathermap.

### Параметр city_id

Идентификатор города, погода в котором интересует.

## Раздел home

Местоположение умного дома. Может быть использовано в пользовательских скриптах.
```json
"home": {
    "city": "Екатеринбург",
    "city_en": "Yekaterinburg",
    "lat": 56.83827, 
    "lon": 60.60345
}
```

### Параметр city

Наименование населённого пункта. В настоящее время не используется.

### Параметр city_en

Наименование населённого пункта на английском языке (может потребоваться, например, при запросе погоды). В настоящее время не используется.

### Параметры lat и lon

Широта и долгота. Используется для вычисления времени восхода и захода солнца.

## Параметр timezone

Часовой пояс умного дома. Используется для задания часового пояса в настройках PHP.
```json
"timezone": "Asia/Yekaterinburg"
```

## Параметр log_dir

Необязательный параметр. Путь до папки для хранения журналов демонов.
```json
"log_dir": "/log/phpmd"
```

## Параметр pid_dir

Необязательный параметр. Путь до папки для хранения pid файлов демонов.

```json
"pid_dir": "/tmp/phpmd/pid"
```

## Параметр admins

Задаёт идентификаторы пользователей из таблицы auth_users, которые имеют уровень доступа администратор, т.е. ко всем разделам сайта без ограничений.
```
"admins": [1]
```